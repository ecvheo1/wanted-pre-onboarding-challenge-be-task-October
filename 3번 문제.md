# (3) 웹 브라우저에 `네이버` 를 검색하고 화면에 네이버 화면이 출력이 될 때 까지 내부적으로 어떤 동작들이 수행이 되는지 설명해주세요.

![img_1.png](img/img_1.png)

# 1. 웹 브라우저 주소창에 www.naver.com 을 입력

# 2. 웹 브라우저의 URL 해석

- 어떤 프로토콜을 통해 해당 URL에 요청할 것인지
- 어떤 URL로 요청할 것인지
- 어떤 포트로 요청할 것인지

브라우저에서 각각 프로토콜, URL, 포트를 해석하여 분석한다.

만약 명시적으로 포트를 선언하지 않았다면 브라우저에서는 설정된 기본값을 이용해 요청한다.

HTTP라면 80번 포트, HTTPS라면 443 포트를 설정하여 기본값으로 요청한다.

# 3. HSTS 목록 조회

HSTS 목록에 해당 URL이 존재한다면 첫 요청을 HTTPS로 보내고, 아닌 경우 HTTP로 보낸다.

만약 HTTP로 요청이 왔다면 HTTP 응답 헤더에 “Strict Transport Security”라는 필드를 포함하여 응답하고, 이를 확인한 브라우저는 서버에 요청할 때 HTTPS만을 통해 통신하게 된다. 그리고 자신의 HSTS 캐시에 해당 URL을 저장하는데, 이를 HSTS 목록이라고 부른다.

HSTS 목록에 해당 URL이 존재한다면 명시적으로 HTTP를 통해 요청한다 해도 브라우저가 이를 HTTPS로 요청한다.

> HSTS(HTTP Strict Transport Security)란?
HTTP 대신 HTTPS만을 사용하여 통신해야 한다고 웹 사이트가 웹 브라우저에 알리는 보안기능
>

# 4. URL을 IP 주소로 변환

브라우저에서 자신의 로컬 hosts 파일과 브라우저 캐시에 해당 URL이 존재하는지 확인한다. 존재하지 않는다면 도메인 주소를 IP 주소로 변환해주는 DNS(Domain Name System) 서버에 요청하여 해당 URL을 IP 주소로 변환한다.

## DNS 서버로 요청하는 과정

1. 미리 설정 된 Local DNS에 해당 URL 주소의 IP주소를 요청합니다.
2. Local DNS에 해당 IP주소가 존재한다면 이를 응답하고, 없다면 다른 DNS 서버와 통신합니다. root DNS 서버에 해당 URL의 IP주소를 요청합니다.
3. root DNS서버에 해당 IP주소가 없다면 하위 DNS 서버에 요청하라고 응답합니다. 이 응답을 받은 Local DNS는 `.com` 도메인을 관리하는 DNS 서버에 같은 내용을 요청합니다.
4. `.com` DNS 서버에 해당 IP주소가 없다면 하위 DNS 서버에 요청하라고 응답합니다. 이 응답을 받은 Local DNS는 `naver.com` 도메인을 관리하는 DNS 서버에 같은 내용을 요청합니다.
5. `naver.com` DNS 서버에서 IP주소를 응답받은 Local DNS는 해당 IP주소를 캐싱하고 응답합니다.

# 5. HTTP Request Message를 만들어, OS에 전송 요청

# 6. 프로토콜 스택과 LAN 어댑터가 신호 송출

1. 프로토콜 스택(운영체제에 내장된 네트워크 제어용 소프트웨어)이 브라우저로부터 메시지를 받는다.
2. 브라우저로부터 받은 메시지를 패킷 속에 저장한다.
3. 그리고 수신처 주소 등의 제어정보를 덧붙인다.
4. 그런 다음, 패킷을 LAN 어댑터에 넘긴다.
5. LAN 어댑터는 다음 Hop의 MAC주소를 붙인 프레임을 전기신호로 변환시킨다.
6. 신호를 LAN 케이블에 송출시킨다.

프로토콜 스택은 통신 중 오류가 발생했을 때, 이 제어 정보를 사용하여 고쳐 보내거나, 각종 상황을 조절하는 등 다양한 역할을 하게 된다.

# 7. 스위칭 허브 → 라우터 → ISP → 인터넷 흐름으로 패킷 이동

1. LAN 어댑터가 송신한 프레임은 스위칭 허브를 경유하여 인터넷 접속용 라우터에 도착한다.
2. 라우터는 라우팅 테이블을 통해 경로를 지정하여 패킷을 ISP(프로바이더, 통신사)에게 전달한다.
3. 인터넷으로 들어가게 된다.

# 8. 엑세스 회선 → 통신사용 라우터 → 인터넷 핵심부 → 목적지 흐름으로 패킷 이동

1. 패킷은 인터넷의 입구에 있는 액세스 회선(통신 회선)에 의해 POP(Point Of Presence, 통신사용 라우터)까지 운반된다.
2. POP 를 거쳐 인터넷의 핵심부로 들어가게 된다.
3. 수 많은 고속 라우터들 사이로 패킷이 목적지를 향해 흘러가게 된다.

# 9. 목적지의 LAN에 도착 후 방화벽이 패킷 검사

1. 패킷은 웹 서버측의 LAN에 도착한다.
2. 기다리고 있던 방화벽이 도착한 패킷을 검사한다.
3. 패킷이 웹 서버까지 가야하는지 가지 않아도 되는지를 판단하는 캐시 서버가 존재한다.

굳이 서버까지 가지 않아도 되는 경우를 골라낸다. 액세스한 페이지의 데이터가 캐시서버에 있으면 웹 서버에 의뢰하지 않고 바로 그 값을 읽을 수 있다. 페이지의 데이터 중에 다시 이용할 수 있는 것이 있으면 캐시 서버에 저장된다.

# 10. 웹 서버에 도착한 패킷을 추출하여 응답 데이터 작성 후 응답

1. 패킷이 물리적인 웹 서버에 도착하면 웹 서버의 프로토콜 스택은 패킷을 추출하여 메시지를 복원하고 웹 서버 애플리케이션에 넘긴다.
2. 메시지를 받은 웹 서버 애플리케이션은 요청에 대한 응답 데이터를 작성하여 클라이언트로 회송한다.
3. 왔던 방식대로 클라이언트에게 전달된다.

# 11. 브라우저에서 응답 해석

서버에서 응답한 내용은 HTML, CSS, Javascript 등으로 이루어져 있다. 이를 브라우저에서 해석하여 그려준다.